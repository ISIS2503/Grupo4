[{"id":"51161fd8.121a3","type":"tab","label":"Processing Flow","disabled":false,"info":""},{"id":"6d1a681e.0facd8","type":"udp in","z":"51161fd8.121a3","name":"UDP incoming temperature","iface":"","port":"6000","ipv":"udp4","multicast":"false","group":"","datatype":"utf8","x":216.25003814697266,"y":162.51734733581543,"wires":[["b172d135.44cc6","e4fae9b7.730288"]]},{"id":"b172d135.44cc6","type":"debug","z":"51161fd8.121a3","name":"incoming data","active":false,"console":"false","complete":"payload","x":429.0834083557129,"y":125.11804103851318,"wires":[]},{"id":"e4fae9b7.730288","type":"json","z":"51161fd8.121a3","name":"Format 2 json","pretty":true,"x":431.0764617919922,"y":198.767352104187,"wires":[["79e73f71.23c4c","12faf0fe.2d37ff"]]},{"id":"79e73f71.23c4c","type":"debug","z":"51161fd8.121a3","name":"JSON format","active":false,"console":"false","complete":"payload","x":621.0648612976074,"y":198.77700757980347,"wires":[]},{"id":"12faf0fe.2d37ff","type":"function","z":"51161fd8.121a3","name":"Add Topic","func":"var res = {};\n\nres.payload = msg.payload;\nres.topic = \"roomTemperature\";\n\nreturn res;","outputs":1,"noerr":0,"x":619.9614673190647,"y":264.78393438127307,"wires":[["396cb031.1c6cf","8cd073ce.98c3f"]]},{"id":"cce36fdf.df93a","type":"inject","z":"51161fd8.121a3","name":"Incoming Time","topic":"incomingTime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":215.51703643798828,"y":354.4135675430298,"wires":[["b568fc71.35fb9","32b2651.dd6699a"]]},{"id":"b568fc71.35fb9","type":"debug","z":"51161fd8.121a3","name":"before format","active":false,"console":"false","complete":"payload","x":418.8464813232422,"y":289.0200614929199,"wires":[]},{"id":"32b2651.dd6699a","type":"function","z":"51161fd8.121a3","name":"Format Time","func":"var res = {};\n\nres.payload = new Date(msg.payload);\nres.topic = msg.topic;\n\nreturn res;","outputs":1,"noerr":0,"x":426.6242684258355,"y":355.8911968866984,"wires":[["93a2a579.d89968","396cb031.1c6cf"]]},{"id":"93a2a579.d89968","type":"debug","z":"51161fd8.121a3","name":"after format","active":false,"console":"false","complete":"payload","x":615.5170288085938,"y":424.5833339691162,"wires":[]},{"id":"396cb031.1c6cf","type":"function","z":"51161fd8.121a3","name":"Merge 2 Msgs","func":"context.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"incomingTime\":\n        context.data.recvtime = msg.payload;\n        msg = null;\n        break;\n    case \"roomTemperature\":\n        context.data.room = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n}\n\nif(context.data.recvtime != null && context.data.room != null) {\n\tres = {};\n    res.payload = context.data;\n    res.topic = \"roomTemperature\"\n    context.data = null;\n\treturn res;\n}","outputs":1,"noerr":0,"x":838.8427124023438,"y":356.00308895111084,"wires":[["ec423b12.1d3e78","ebcd96a4.866888","8fe2bca5.38db"]]},{"id":"8cd073ce.98c3f","type":"debug","z":"51161fd8.121a3","name":"after topic","active":false,"console":"false","complete":"payload","x":821.0688018798828,"y":265.19675159454346,"wires":[]},{"id":"ec423b12.1d3e78","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Tpsec","collection":"tempsecs","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1055.0113830566406,"y":268.84889698028564,"wires":[]},{"id":"ebcd96a4.866888","type":"debug","z":"51161fd8.121a3","name":"after merge","active":false,"console":"false","complete":"payload","x":1038.8465881347656,"y":355.06943798065186,"wires":[]},{"id":"8fe2bca5.38db","type":"link out","z":"51161fd8.121a3","name":"Temp","links":["a34ed7f6.3a8398"],"x":984.3943996429443,"y":412.0987539291382,"wires":[]},{"id":"45356137.1ad24","type":"inject","z":"51161fd8.121a3","name":"Processing Signal","topic":"","payload":"true","payloadType":"bool","repeat":"60","crontab":"","once":false,"x":209.9893527560764,"y":1748.3783324559531,"wires":[["a78b681b.beb648","3f55e1e6.97bc9e"]]},{"id":"a78b681b.beb648","type":"function","z":"51161fd8.121a3","name":"Create Query","func":"var res = {};\nres.skip = 0;\nres.limit = 60;\nvar signal = msg.payload;\n\nvar maxtime = new Date(Date.now() - 1*60*1000).toISOString();\nvar query = {'room.sensetime':{$gte: maxtime}};\n\nif(signal === true){\n      res.payload = query;\n      res.topic = \"mongoQuery\";\n      return res;\n  }","outputs":1,"noerr":0,"x":448.196162753635,"y":1735.6050942738852,"wires":[["47a2fadb.8b3d44","ee744b44.dd5828"]]},{"id":"3f55e1e6.97bc9e","type":"debug","z":"51161fd8.121a3","name":"boolean signal","active":false,"console":"false","complete":"payload","x":448.20386844211157,"y":1787.8851569493613,"wires":[]},{"id":"47a2fadb.8b3d44","type":"debug","z":"51161fd8.121a3","name":"query signal","active":false,"console":"false","complete":"payload","x":677.0850825839573,"y":1735.659123738607,"wires":[]},{"id":"ee744b44.dd5828","type":"mongodb in","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Find Tsec","collection":"tempsecs","operation":"find","x":656.128276401096,"y":1798.1976941426597,"wires":[["b2682e19.f973a","440d782.1ca4d88"]]},{"id":"b2682e19.f973a","type":"debug","z":"51161fd8.121a3","name":"query result","active":false,"console":"false","complete":"payload","x":877.2279086642795,"y":1796.0912354787192,"wires":[]},{"id":"440d782.1ca4d88","type":"function","z":"51161fd8.121a3","name":"Processing Average","func":"var res = {};\nvar query = msg.payload;\nvar avgUnit = query[0].room.temperature.unit;\nvar avgMicroNum = query[0].room.temperature.MicrocontroladorNum;\nvar avgArea = query[0].room.temperature.Area;\nvar avgNivel = query[0].room.temperature.Nivel;\nvar tempData = 0;\nvar avgTemp = 0;\nvar avgTime = 0;\n\n// procesa la temperatura promedio del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + query[i].room.temperature.data;\n}\n\navgTemp = parseInt(tempData/query.length);\ntempData = 0;\n\n// calcula el tiempo estimado del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + new Date(query[i].room.sensetime).getTime();\n}\n\navgTime = Math.round(tempData/query.length);\navgTime = new Date(avgTime);\n\nres = {protime:new Date(Date.now()), sensor: \"Temperature sensor\", data:avgTemp, unit:avgUnit, MicrocontroladorNum: avgMicroNum, Area: avgArea, Nivel: avgNivel};\nreturn res;","outputs":1,"noerr":0,"x":905.9855575561523,"y":1740.3118686676025,"wires":[["72289f64.4586d","dfc7fa28.0a5728","fd882886.2ab658"]]},{"id":"fd882886.2ab658","type":"debug","z":"51161fd8.121a3","name":"final result","active":false,"console":"false","complete":"payload","x":1130.8429256015354,"y":1718.4686017831168,"wires":[]},{"id":"dfc7fa28.0a5728","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Tmin","collection":"sensormins","payonly":false,"upsert":false,"multi":false,"operation":"store","x":1140.9817538791233,"y":1772.537330945333,"wires":[]},{"id":"72289f64.4586d","type":"link out","z":"51161fd8.121a3","name":"Mins tempFlow","links":["1e0d7fbf.37431"],"x":1086.8151240878635,"y":1845.5124562581382,"wires":[]},{"id":"83a36668.c4f4f8","type":"udp in","z":"51161fd8.121a3","name":"UDP incoming noice","iface":"","port":"6001","ipv":"udp4","multicast":"false","group":"","datatype":"utf8","x":203.25787734985352,"y":517.5234231948853,"wires":[["b7b95abc.1f74b8","f646ee00.46ea2"]]},{"id":"b7b95abc.1f74b8","type":"debug","z":"51161fd8.121a3","name":"incoming data","active":false,"console":"false","complete":"payload","x":409.9176254272461,"y":519.124119758606,"wires":[]},{"id":"f646ee00.46ea2","type":"json","z":"51161fd8.121a3","name":"Format 2 json","pretty":true,"x":411.9106788635254,"y":592.7734308242798,"wires":[["a0bcf239.77b4f","20723b14.198d84"]]},{"id":"a0bcf239.77b4f","type":"debug","z":"51161fd8.121a3","name":"JSON format","active":false,"console":"false","complete":"payload","x":601.8990783691406,"y":592.7830862998962,"wires":[]},{"id":"20723b14.198d84","type":"function","z":"51161fd8.121a3","name":"Add Topic","func":"var res = {};\n\nres.payload = msg.payload;\nres.topic = \"roomNoice\";\n\nreturn res;","outputs":1,"noerr":0,"x":600.7956843905979,"y":658.7900131013658,"wires":[["f2e7963b.889378","ca8822e4.db4ab"]]},{"id":"783d8a14.89b1f4","type":"inject","z":"51161fd8.121a3","name":"Incoming Time","topic":"incomingTime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":196.35125350952148,"y":748.4196462631226,"wires":[["4dbc7030.96d2c","83eb8b5c.87a638"]]},{"id":"4dbc7030.96d2c","type":"debug","z":"51161fd8.121a3","name":"before format","active":false,"console":"false","complete":"payload","x":399.6806983947754,"y":683.0261402130127,"wires":[]},{"id":"83eb8b5c.87a638","type":"function","z":"51161fd8.121a3","name":"Format Time","func":"var res = {};\n\nres.payload = new Date(msg.payload);\nres.topic = msg.topic;\n\nreturn res;","outputs":1,"noerr":0,"x":407.45848549736866,"y":749.8972756067913,"wires":[["9a0f8136.1c81a","f2e7963b.889378"]]},{"id":"9a0f8136.1c81a","type":"debug","z":"51161fd8.121a3","name":"after format","active":false,"console":"false","complete":"payload","x":596.351245880127,"y":818.589412689209,"wires":[]},{"id":"f2e7963b.889378","type":"function","z":"51161fd8.121a3","name":"Merge 2 Msgs","func":"context.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"incomingTime\":\n        context.data.recvtime = msg.payload;\n        msg = null;\n        break;\n    case \"roomNoice\":\n        context.data.room = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n}\n\nif(context.data.recvtime != null && context.data.room != null) {\n\tres = {};\n    res.payload = context.data;\n    res.topic = \"roomNoice\"\n    context.data = null;\n\treturn res;\n}","outputs":1,"noerr":0,"x":819.676929473877,"y":750.0091676712036,"wires":[["b9d82542.92ba48","877a7eb4.ae9c3","caa769f9.d7dd18"]]},{"id":"ca8822e4.db4ab","type":"debug","z":"51161fd8.121a3","name":"after topic","active":false,"console":"false","complete":"payload","x":801.903018951416,"y":659.2028303146362,"wires":[]},{"id":"b9d82542.92ba48","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Nsec","collection":"noicesecs","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1026.845085144043,"y":684.8548746109009,"wires":[]},{"id":"877a7eb4.ae9c3","type":"debug","z":"51161fd8.121a3","name":"after merge","active":false,"console":"false","complete":"payload","x":1019.6808052062988,"y":749.0755167007446,"wires":[]},{"id":"caa769f9.d7dd18","type":"link out","z":"51161fd8.121a3","name":"Noice","links":["30e2be.b78b5d42"],"x":965.2286167144775,"y":806.104832649231,"wires":[]},{"id":"178e9fb3.acb93","type":"udp in","z":"51161fd8.121a3","name":"UDP incoming carbon dioxide","iface":"","port":"6002","ipv":"udp4","multicast":"false","group":"","datatype":"utf8","x":173.7578125,"y":949.773416519165,"wires":[["84ba9566.7549e8","58117dc8.697874"]]},{"id":"84ba9566.7549e8","type":"debug","z":"51161fd8.121a3","name":"incoming data","active":false,"console":"false","complete":"payload","x":398.4175605773926,"y":930.3740844726562,"wires":[]},{"id":"58117dc8.697874","type":"json","z":"51161fd8.121a3","name":"Format 2 json","pretty":true,"x":400.4106140136719,"y":1004.0233955383301,"wires":[["5dbe02e0.5e48ac","6c9922b5.e99fcc"]]},{"id":"5dbe02e0.5e48ac","type":"debug","z":"51161fd8.121a3","name":"JSON format","active":false,"console":"false","complete":"payload","x":590.3990135192871,"y":1004.0330510139465,"wires":[]},{"id":"6c9922b5.e99fcc","type":"function","z":"51161fd8.121a3","name":"Add Topic","func":"var res = {};\n\nres.payload = msg.payload;\nres.topic = \"roomCarbonDioxide\";\n\nreturn res;","outputs":1,"noerr":0,"x":589.2956195407444,"y":1070.039977815416,"wires":[["5531c8b.cde5738","d33921fe.a3736"]]},{"id":"a450344d.ef89c8","type":"inject","z":"51161fd8.121a3","name":"Incoming Time","topic":"incomingTime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":184.85118865966797,"y":1159.6696109771729,"wires":[["15d6bfbf.a2742","6f614e00.6eb3d4"]]},{"id":"15d6bfbf.a2742","type":"debug","z":"51161fd8.121a3","name":"before format","active":false,"console":"false","complete":"payload","x":388.1806335449219,"y":1094.276104927063,"wires":[]},{"id":"6f614e00.6eb3d4","type":"function","z":"51161fd8.121a3","name":"Format Time","func":"var res = {};\n\nres.payload = new Date(msg.payload);\nres.topic = msg.topic;\n\nreturn res;","outputs":1,"noerr":0,"x":395.95842064751514,"y":1161.1472403208415,"wires":[["33834040.da7df","5531c8b.cde5738"]]},{"id":"33834040.da7df","type":"debug","z":"51161fd8.121a3","name":"after format","active":false,"console":"false","complete":"payload","x":584.8511810302734,"y":1229.8393774032593,"wires":[]},{"id":"5531c8b.cde5738","type":"function","z":"51161fd8.121a3","name":"Merge 2 Msgs","func":"context.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"incomingTime\":\n        context.data.recvtime = msg.payload;\n        msg = null;\n        break;\n    case \"roomCarbonDioxide\":\n        context.data.room = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n}\n\nif(context.data.recvtime != null && context.data.room != null) {\n\tres = {};\n    res.payload = context.data;\n    res.topic = \"roomCarbonDioxide\"\n    context.data = null;\n\treturn res;\n}","outputs":1,"noerr":0,"x":808.1768646240234,"y":1161.259132385254,"wires":[["e12ed087.bdbff","15c509f0.fa5866","dbbaa749.1ac608"]]},{"id":"d33921fe.a3736","type":"debug","z":"51161fd8.121a3","name":"after topic","active":false,"console":"false","complete":"payload","x":790.4029541015625,"y":1070.4527950286865,"wires":[]},{"id":"e12ed087.bdbff","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save CDsec","collection":"carbonsecs","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1025.3450889587402,"y":1093.1049156188965,"wires":[]},{"id":"15c509f0.fa5866","type":"debug","z":"51161fd8.121a3","name":"after merge","active":false,"console":"false","complete":"payload","x":1008.1807403564453,"y":1160.325481414795,"wires":[]},{"id":"dbbaa749.1ac608","type":"link out","z":"51161fd8.121a3","name":"CD","links":["7fe3a80f.718738"],"x":953.728551864624,"y":1217.3547973632812,"wires":[]},{"id":"98b50bb4.3d3d78","type":"udp in","z":"51161fd8.121a3","name":"UDP incoming ilumination","iface":"","port":"6003","ipv":"udp4","multicast":"false","group":"","datatype":"utf8","x":161.5078125,"y":1348.5232973098755,"wires":[["e6bf224e.161","e4663061.6536d"]]},{"id":"e6bf224e.161","type":"debug","z":"51161fd8.121a3","name":"incoming data","active":false,"console":"false","complete":"payload","x":419.1675605773926,"y":1338.1240119934082,"wires":[]},{"id":"e4663061.6536d","type":"json","z":"51161fd8.121a3","name":"Format 2 json","pretty":true,"x":421.1606140136719,"y":1411.773323059082,"wires":[["76414517.d5c37c","58c93874.6acce8"]]},{"id":"76414517.d5c37c","type":"debug","z":"51161fd8.121a3","name":"JSON format","active":false,"console":"false","complete":"payload","x":611.1490135192871,"y":1411.7829785346985,"wires":[]},{"id":"58c93874.6acce8","type":"function","z":"51161fd8.121a3","name":"Add Topic","func":"var res = {};\n\nres.payload = msg.payload;\nres.topic = \"roomIlumination\";\n\nreturn res;","outputs":1,"noerr":0,"x":610.0456195407444,"y":1477.789905336168,"wires":[["898a699e.39c588","54697af3.6a64c4"]]},{"id":"92cfef56.67e4d","type":"inject","z":"51161fd8.121a3","name":"Incoming Time","topic":"incomingTime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":205.60118865966797,"y":1567.4195384979248,"wires":[["2b9b2dde.142db2","fef87834.7306d8"]]},{"id":"2b9b2dde.142db2","type":"debug","z":"51161fd8.121a3","name":"before format","active":false,"console":"false","complete":"payload","x":408.9306335449219,"y":1502.026032447815,"wires":[]},{"id":"fef87834.7306d8","type":"function","z":"51161fd8.121a3","name":"Format Time","func":"var res = {};\n\nres.payload = new Date(msg.payload);\nres.topic = msg.topic;\n\nreturn res;","outputs":1,"noerr":0,"x":416.70842064751514,"y":1568.8971678415935,"wires":[["b8814834.3b8d58","898a699e.39c588"]]},{"id":"b8814834.3b8d58","type":"debug","z":"51161fd8.121a3","name":"after format","active":false,"console":"false","complete":"payload","x":605.6011810302734,"y":1637.5893049240112,"wires":[]},{"id":"898a699e.39c588","type":"function","z":"51161fd8.121a3","name":"Merge 2 Msgs","func":"context.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"incomingTime\":\n        context.data.recvtime = msg.payload;\n        msg = null;\n        break;\n    case \"roomIlumination\":\n        context.data.room = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n}\n\nif(context.data.recvtime != null && context.data.room != null) {\n\tres = {};\n    res.payload = context.data;\n    res.topic = \"roomIlumination\"\n    context.data = null;\n\treturn res;\n}","outputs":1,"noerr":0,"x":828.9268646240234,"y":1569.0090599060059,"wires":[["f9960a56.3edad8","d49e8b9d.104bb8","882e0791.018dc8"]]},{"id":"54697af3.6a64c4","type":"debug","z":"51161fd8.121a3","name":"after topic","active":false,"console":"false","complete":"payload","x":811.1529541015625,"y":1478.2027225494385,"wires":[]},{"id":"f9960a56.3edad8","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Isec","collection":"iluminationsecs","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1026.0950202941895,"y":1503.8547668457031,"wires":[]},{"id":"d49e8b9d.104bb8","type":"debug","z":"51161fd8.121a3","name":"after merge","active":false,"console":"false","complete":"payload","x":1047.9308433532715,"y":1580.0755290985107,"wires":[]},{"id":"882e0791.018dc8","type":"link out","z":"51161fd8.121a3","name":"Ilumination","links":["1b238993.1c8be6"],"x":974.478551864624,"y":1625.1047248840332,"wires":[]},{"id":"4a87b72a.3473b8","type":"inject","z":"51161fd8.121a3","name":"Processing Signal","topic":"","payload":"true","payloadType":"bool","repeat":"120","crontab":"","once":false,"x":200.13487582736548,"y":1935.6539223988852,"wires":[["bc6debf3.400e38","f54a52fd.8b76"]]},{"id":"bc6debf3.400e38","type":"function","z":"51161fd8.121a3","name":"Create Query","func":"var res = {};\nres.skip = 0;\nres.limit = 120;\nvar signal = msg.payload;\n\nvar maxtime = new Date(Date.now() - 1*120*1000).toISOString();\nvar query = {'room.sensetime':{$gte: maxtime}};\n\nif(signal === true){\n      res.payload = query;\n      res.topic = \"mongoQuery\";\n      return res;\n  }","outputs":1,"noerr":0,"x":438.34168582492407,"y":1922.8806842168174,"wires":[["8390178d.aea138","bf921783.d81868"]]},{"id":"f54a52fd.8b76","type":"debug","z":"51161fd8.121a3","name":"boolean signal","active":false,"console":"false","complete":"payload","x":438.34939151340063,"y":1975.1607468922934,"wires":[]},{"id":"8390178d.aea138","type":"debug","z":"51161fd8.121a3","name":"query signal","active":false,"console":"false","complete":"payload","x":667.2306018405491,"y":1922.9346516927085,"wires":[]},{"id":"bf921783.d81868","type":"mongodb in","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Find Nsec","collection":"noicesecs","operation":"find","x":646.273799472385,"y":1985.4732840855918,"wires":[["22135829.f142b8","208efd72.cd60e2"]]},{"id":"22135829.f142b8","type":"debug","z":"51161fd8.121a3","name":"query result","active":false,"console":"false","complete":"payload","x":867.3734317355686,"y":1983.3668254216514,"wires":[]},{"id":"208efd72.cd60e2","type":"function","z":"51161fd8.121a3","name":"Processing Average","func":"var res = {};\nvar query = msg.payload;\nvar avgUnit = query[0].room.noice.unit;\nvar avgMicroNum = query[0].room.noice.MicrocontroladorNum;\nvar avgArea = query[0].room.noice.Area;\nvar avgNivel = query[0].room.noice.Nivel;\nvar tempData = 0;\nvar avgTemp = 0;\nvar avgTime = 0;\n\n// procesa la temperatura promedio del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + query[i].room.noice.data;\n}\n\navgTemp = parseInt(tempData/query.length);\ntempData = 0;\n\n// calcula el tiempo estimado del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + new Date(query[i].room.sensetime).getTime();\n}\n\navgTime = Math.round(tempData/query.length);\navgTime = new Date(avgTime);\n\nres = {protime:new Date(Date.now()), sensor: \"Noise sensor\", data:avgTemp, unit:avgUnit, MicrocontroladorNum: avgMicroNum, Area: avgArea, Nivel: avgNivel};\nreturn res;","outputs":1,"noerr":0,"x":896.1310806274414,"y":1927.5874586105347,"wires":[["aeef6514.8373d8","183f2972.69c9c7","f0b6a78e.93e098"]]},{"id":"f0b6a78e.93e098","type":"debug","z":"51161fd8.121a3","name":"final result","active":false,"console":"false","complete":"payload","x":1126.9883761935764,"y":1931.4942525227866,"wires":[]},{"id":"183f2972.69c9c7","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Nmin","collection":"sensormins","payonly":false,"upsert":false,"multi":false,"operation":"store","x":1131.1272464328342,"y":1980.8127749760947,"wires":[]},{"id":"aeef6514.8373d8","type":"link out","z":"51161fd8.121a3","name":"Mins noiceFlow","links":["258e94ce.1f7dcc"],"x":1076.9606471591526,"y":2032.7880462010703,"wires":[]},{"id":"80e74db.8448fb","type":"inject","z":"51161fd8.121a3","name":"Processing Signal","topic":"","payload":"true","payloadType":"bool","repeat":"60","crontab":"","once":false,"x":205.13487582736548,"y":2134.4039223988852,"wires":[["aeb34fa3.2db5c","ad43c615.cbf5f8"]]},{"id":"aeb34fa3.2db5c","type":"function","z":"51161fd8.121a3","name":"Create Query","func":"var res = {};\nres.skip = 0;\nres.limit = 60;\nvar signal = msg.payload;\n\nvar maxtime = new Date(Date.now() - 1*60*1000).toISOString();\nvar query = {'room.sensetime':{$gte: maxtime}};\n\nif(signal === true){\n      res.payload = query;\n      res.topic = \"mongoQuery\";\n      return res;\n  }","outputs":1,"noerr":0,"x":443.34168582492407,"y":2121.6306842168174,"wires":[["16227433.062dec","ded00aaa.f6aef8"]]},{"id":"ad43c615.cbf5f8","type":"debug","z":"51161fd8.121a3","name":"boolean signal","active":false,"console":"false","complete":"payload","x":443.34939151340063,"y":2173.9107468922934,"wires":[]},{"id":"16227433.062dec","type":"debug","z":"51161fd8.121a3","name":"query signal","active":false,"console":"false","complete":"payload","x":672.2306056552463,"y":2121.684713681539,"wires":[]},{"id":"ded00aaa.f6aef8","type":"mongodb in","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Find Csec","collection":"carbonsecs","operation":"find","x":651.273799472385,"y":2184.223284085592,"wires":[["7741fe2d.1d388","57e5c681.4026f8"]]},{"id":"7741fe2d.1d388","type":"debug","z":"51161fd8.121a3","name":"query result","active":false,"console":"false","complete":"payload","x":872.3734317355686,"y":2182.1168254216514,"wires":[]},{"id":"57e5c681.4026f8","type":"function","z":"51161fd8.121a3","name":"Processing Average","func":"var res = {};\nvar query = msg.payload;\nvar avgUnit = query[0].room.carbonDioxide.unit;\nvar avgMicroNum = query[0].room.carbonDioxide.MicrocontroladorNum;\nvar avgArea = query[0].room.carbonDioxide.Area;\nvar avgNivel = query[0].room.carbonDioxide.Nivel;\nvar tempData = 0;\nvar avgTemp = 0;\nvar avgTime = 0;\n\n// procesa la temperatura promedio del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + query[i].room.carbonDioxide.data;\n}\n\navgTemp = parseInt(tempData/query.length);\ntempData = 0;\n\n// calcula el tiempo estimado del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + new Date(query[i].room.sensetime).getTime();\n}\n\navgTime = Math.round(tempData/query.length);\navgTime = new Date(avgTime);\n\n\nres = {protime:new Date(Date.now()), sensor: \"Carbon monoxide sensor\", data:avgTemp, unit:avgUnit, MicrocontroladorNum: avgMicroNum, Area: avgArea, Nivel: avgNivel};\nreturn res;","outputs":1,"noerr":0,"x":901.1310806274414,"y":2126.3374586105347,"wires":[["72553164.5b6e6","d4888793.3311a8","56e96f61.b0e17"]]},{"id":"56e96f61.b0e17","type":"debug","z":"51161fd8.121a3","name":"final result","active":true,"console":"false","complete":"res","x":1125.9882922702366,"y":2127.2440780003867,"wires":[]},{"id":"d4888793.3311a8","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Cmin","collection":"sensormins","payonly":false,"upsert":false,"multi":false,"operation":"store","x":1136.1272464328342,"y":2179.5627749760947,"wires":[]},{"id":"72553164.5b6e6","type":"link out","z":"51161fd8.121a3","name":"Mins carbonFlow","links":["623049e3.232d18"],"x":1081.9606471591526,"y":2231.5380462010703,"wires":[]},{"id":"7596cb.fbd37934","type":"inject","z":"51161fd8.121a3","name":"Processing Signal","topic":"","payload":"true","payloadType":"bool","repeat":"120","crontab":"","once":false,"x":193.88487582736548,"y":2336.9039223988852,"wires":[["5b373a5f.51c774","ffdfa810.254d18"]]},{"id":"5b373a5f.51c774","type":"function","z":"51161fd8.121a3","name":"Create Query","func":"var res = {};\nres.skip = 0;\nres.limit = 120;\nvar signal = msg.payload;\n\nvar maxtime = new Date(Date.now() - 1*120*1000).toISOString();\nvar query = {'room.sensetime':{$gte: maxtime}};\n\nif(signal === true){\n      res.payload = query;\n      res.topic = \"mongoQuery\";\n      return res;\n  }","outputs":1,"noerr":0,"x":432.09168582492407,"y":2324.1306842168174,"wires":[["849c6e70.715bb","be5dc372.0c35a"]]},{"id":"ffdfa810.254d18","type":"debug","z":"51161fd8.121a3","name":"boolean signal","active":true,"console":"false","complete":"payload","x":432.09939151340063,"y":2376.4107468922934,"wires":[]},{"id":"849c6e70.715bb","type":"debug","z":"51161fd8.121a3","name":"query signal","active":true,"console":"false","complete":"payload","x":660.9806056552463,"y":2324.184713681539,"wires":[]},{"id":"be5dc372.0c35a","type":"mongodb in","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Find Isec","collection":"iluminationsecs","operation":"find","x":640.023799472385,"y":2386.723284085592,"wires":[["dfdbdaae.c3a358","6bad7c6e.c42c04"]]},{"id":"dfdbdaae.c3a358","type":"debug","z":"51161fd8.121a3","name":"query result","active":false,"console":"false","complete":"payload","x":861.1234317355686,"y":2384.6168254216514,"wires":[]},{"id":"6bad7c6e.c42c04","type":"function","z":"51161fd8.121a3","name":"Processing Average","func":"var res = {payload:null};\nvar query = msg.payload;\nvar avgUnit = query[0].room.ilumination.unit;\nvar avgMicroNum = query[0].room.ilumination.MicrocontroladorNum;\nvar avgArea = query[0].room.ilumination.Area;\nvar avgNivel = query[0].room.ilumination.Nivel;\nvar tempData = 0;\nvar avgTemp = 0;\nvar avgTime = 0;\n\n// procesa la temperatura promedio del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + query[i].room.ilumination.data;\n}\n\navgTemp = parseInt(tempData/query.length);\ntempData = 0;\n\n// calcula el tiempo estimado del intervalo\nfor(var i = 0; i < query.length; i++){\n    \n    tempData = tempData + new Date(query[i].room.sensetime).getTime();\n}\n\navgTime = Math.round(tempData/query.length);\navgTime = new Date(avgTime);\n\n\nres = {protime:new Date(Date.now()), sensor: \"Ilumination sensor\", data:avgTemp, unit:avgUnit, MicrocontroladorNum: avgMicroNum, Area: avgArea, Nivel: avgNivel};\nreturn res;","outputs":1,"noerr":0,"x":889.8810806274414,"y":2328.8374586105347,"wires":[["7b4d2614.a6fee8","e3663ddc.f0b2f","5dec3de6.c3b5e4"]]},{"id":"5dec3de6.c3b5e4","type":"debug","z":"51161fd8.121a3","name":"final result","active":false,"console":"false","complete":"payload","x":1124.7383456759983,"y":2326.7440207799277,"wires":[]},{"id":"e3663ddc.f0b2f","type":"mongodb out","z":"51161fd8.121a3","mongodb":"37e759e.cc08fa6","name":"Save Imin","collection":"sensormins","payonly":false,"upsert":false,"multi":false,"operation":"store","x":1114.8772464328342,"y":2382.0627749760947,"wires":[]},{"id":"7b4d2614.a6fee8","type":"link out","z":"51161fd8.121a3","name":"Mins ilumFlow","links":["7617c049.84e31"],"x":1074.710753970676,"y":2434.0379737218223,"wires":[]},{"id":"37e759e.cc08fa6","type":"mongodb","z":"","hostname":"ds149144.mlab.com","port":"49144","db":"mina_samaca_g4","name":"prueba"}]