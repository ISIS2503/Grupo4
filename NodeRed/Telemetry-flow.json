[{"id":"b496b6c8.adfa18","type":"tab","label":"Telemetry flow","disabled":false,"info":""},{"id":"a42ed36.6f4763","type":"serial in","z":"b496b6c8.adfa18","name":"temperatureSensor","serial":"ed7c327a.572fd","x":161.10000610351562,"y":161.8000030517578,"wires":[["60b9f2cd.f272bc","3c04d2dc.d072ce"]]},{"id":"83a8db3c.eca448","type":"inject","z":"b496b6c8.adfa18","name":"sensorTime","topic":"roomTime","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":190,"y":260,"wires":[["61e982a3.e5840c","80d71ff7.240e8"]]},{"id":"60b9f2cd.f272bc","type":"function","z":"b496b6c8.adfa18","name":"Format Temperature","func":"var res = {};\nvar tempArray = [];\nvar tempUnit = \"\";\n\ntempString = msg.payload;\ntempArray = tempString.split(\"\\t\");\ntempUnit = tempArray[1].replace(\"\\r\\n\", \"\");\nres.topic = \"roomTemperature\";\nres.payload = {};\n\nres.payload = {\"data\": parseInt(tempArray[0]), \"unit\": tempUnit, \"place\": \"Deposito Externo\"}\n\nreturn res;","outputs":1,"noerr":0,"x":400,"y":160,"wires":[["49eea7da.8f3018","f71467e6.ae70b8"]]},{"id":"61e982a3.e5840c","type":"function","z":"b496b6c8.adfa18","name":"Format Time","func":"var res = {};\n\nres.payload = new Date(msg.payload);\nres.topic = msg.topic;\n\nreturn res;","outputs":1,"noerr":0,"x":370,"y":260,"wires":[["352975ff.51e88a","f71467e6.ae70b8"]]},{"id":"3c04d2dc.d072ce","type":"debug","z":"b496b6c8.adfa18","name":"before format","active":false,"console":"false","complete":"true","x":370,"y":120,"wires":[]},{"id":"49eea7da.8f3018","type":"debug","z":"b496b6c8.adfa18","name":"after format","active":false,"console":"false","complete":"true","x":630,"y":120,"wires":[]},{"id":"80d71ff7.240e8","type":"debug","z":"b496b6c8.adfa18","name":"before format","active":false,"console":"false","complete":"true","x":370,"y":220,"wires":[]},{"id":"352975ff.51e88a","type":"debug","z":"b496b6c8.adfa18","name":"after format","active":false,"console":"false","complete":"true","x":630,"y":280,"wires":[]},{"id":"f71467e6.ae70b8","type":"function","z":"b496b6c8.adfa18","name":"Merge 2 Messages","func":"context.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"roomTime\":\n        context.data.sensetime = msg.payload;\n        msg = null;\n        break;\n    case \"roomTemperature\":\n        context.data.temperature = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n}\n\nif(context.data.sensetime != null && context.data.temperature != null) {\n\tres = {};\n    res.payload = JSON.stringify(context.data);\n    res.topic = \"roomTemperature\"\n    context.data = null;\n\treturn res;\n}","outputs":1,"noerr":0,"x":650,"y":200,"wires":[["1dc6cb23.3a2bc5","193a24b0.66592b","10921eb.e806ce1"]]},{"id":"1dc6cb23.3a2bc5","type":"debug","z":"b496b6c8.adfa18","name":"after merge","active":false,"console":"false","complete":"true","x":870,"y":220,"wires":[]},{"id":"193a24b0.66592b","type":"mqtt out","z":"b496b6c8.adfa18","name":"alta/piso1/local1","topic":"alta.piso1.local1","qos":"0","retain":"false","broker":"9a93e3d6.efb89","x":920,"y":160,"wires":[]},{"id":"10921eb.e806ce1","type":"udp out","z":"b496b6c8.adfa18","name":"Send temperature","addr":"localhost","iface":"","port":"6000","ipv":"udp4","outport":"","base64":false,"multicast":"false","x":934.1000366210938,"y":97.60000610351562,"wires":[]},{"id":"ed7c327a.572fd","type":"serial-port","z":"","serialport":"COM4","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"9a93e3d6.efb89","type":"mqtt-broker","z":"","broker":"172.24.42.57","port":"8083","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willPayload":"","birthTopic":"","birthQos":"0","birthPayload":""}]